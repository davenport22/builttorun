import{c as v,j as e,b as E,L as _,C as F,r as b,k as g}from"./index-BRLjwUl5.js";import{u as I,P as M}from"./page-container-CooLEeSj.js";import{S as T,U as R,u as W,a as D,E as z}from"./use-events-Dw3opNDw.js";import{d as L,a as A}from"./formatting-6Y3PSrOr.js";import{g as V}from"./images-if8H7XIe.js";import{C as S}from"./calendar-Dynw39cp.js";import{M as q}from"./map-pin-Cg3AAMPG.js";import{u as B}from"./index.esm-DwLMQWH-.js";import{u as U}from"./use-offices-BdtzSyWv.js";import{u as P}from"./use-profile-BXE7ia1g.js";import{O as G}from"./offices-DNeqOdnQ.js";import{C as K}from"./circle-alert-xLKzMs_p.js";import"./useMutation-BnaJWjYm.js";const X=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],Y=v("chevron-left",X);const H=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Q=v("chevron-right",H);const J=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],Z=v("globe",J);const ee=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],te=v("x",ee);function se(t){const s=[`*${t.name}*`];return s.push(`Date: ${L(t.date)}`),t.location&&s.push(`Location: ${t.location}`),t.distance_km&&s.push(`Distance: ${A(t.distance_km)} km`),t.website_url&&s.push(t.website_url),s.push(`
Found on Built to Run`),`https://wa.me/?text=${encodeURIComponent(s.join(`
`))}`}function ae({event:t,index:s=0}){const o=t.participations?.filter(l=>l.status==="going").length??0,r=t.participations?.filter(l=>l.status==="interested").length??0,n=o+r;return e.jsxs("div",{className:"overflow-hidden rounded-2xl bg-white shadow-sm",children:[e.jsxs(E,{to:`/events/${t.id}`,className:"relative block h-32 w-full overflow-hidden",children:[e.jsx("img",{src:V(s),alt:"",className:"h-full w-full object-cover grayscale"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-brand-dark-petrol/80 to-transparent"}),e.jsx("div",{className:"absolute inset-x-0 bottom-0 p-3",children:e.jsx("h3",{className:"text-sm font-bold text-white",children:t.name})}),e.jsx("a",{href:se(t),target:"_blank",rel:"noopener noreferrer",onClick:l=>l.stopPropagation(),className:"absolute right-2 top-2 flex h-8 w-8 items-center justify-center rounded-full bg-white/90 text-brand-dark-petrol shadow-sm backdrop-blur-sm transition-transform hover:scale-110",title:"Share via WhatsApp",children:e.jsx(T,{className:"h-3.5 w-3.5"})})]}),e.jsxs(E,{to:`/events/${t.id}`,className:"block p-3.5",children:[e.jsxs("div",{className:"flex flex-col gap-1.5",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(S,{className:"h-3 w-3 text-brand-teal"}),L(t.date)]}),t.location&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(q,{className:"h-3 w-3 text-brand-teal"}),t.location]})]}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[t.distance_km&&e.jsxs("span",{className:"rounded-full bg-brand-dark-petrol/10 px-2.5 py-0.5 text-xs font-bold text-brand-dark-petrol",children:[A(t.distance_km)," km"]}),t.offices&&e.jsx("span",{className:"rounded-full px-2.5 py-0.5 text-xs font-bold text-white",style:{backgroundColor:t.offices.color_theme??"#00677F"},children:t.offices.name})]}),n>0&&e.jsxs("div",{className:"flex items-center gap-1 text-xs font-medium text-muted-foreground",children:[e.jsx(R,{className:"h-3 w-3"}),n]})]})]})]})}function re({officeId:t}){const{data:s,isLoading:o}=W(t);return o?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_,{className:"h-5 w-5 animate-spin text-brand-teal"})}):!s||s.length===0?e.jsxs("div",{className:"flex flex-col items-center gap-3 py-12 text-center",children:[e.jsx(S,{className:"h-12 w-12 text-gray-200"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-foreground",children:"No upcoming races"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Add a race to get the team running together!"})]})]}):e.jsx("div",{className:"flex flex-col gap-3",children:s.map((r,n)=>e.jsx(ae,{event:r,index:n},r.id))})}function ne({onSuccess:t}){const s=D(),{data:o}=U(),{data:r}=P(),{register:n,handleSubmit:l,formState:{errors:c,isSubmitting:x}}=B({defaultValues:{name:"",date:"",location:"",distance_km:"",website_url:"",office_id:r?.office_id??""}}),f=async i=>{const u=parseFloat(i.distance_km);await s.mutateAsync({name:i.name,date:i.date,location:i.location||null,distance_km:!isNaN(u)&&u>0?u:null,website_url:i.website_url||null,office_id:i.office_id||null}),t?.()},d="w-full rounded-xl border border-input bg-muted/50 px-4 py-2.5 text-sm outline-none ring-ring transition-colors focus:bg-white focus:ring-2";return e.jsxs("form",{onSubmit:l(f),className:"flex flex-col gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventName",className:"mb-1 block text-sm font-semibold text-foreground",children:"Race / Event Name *"}),e.jsx("input",{id:"eventName",type:"text",className:d,placeholder:"e.g., Vienna City Marathon",...n("name",{required:"Event name is required"})}),c.name&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:c.name.message})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventDate",className:"mb-1 block text-sm font-semibold text-foreground",children:"Date *"}),e.jsx("input",{id:"eventDate",type:"date",className:d,...n("date",{required:"Date is required"})}),c.date&&e.jsx("p",{className:"mt-1 text-xs text-destructive",children:c.date.message})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventDistance",className:"mb-1 block text-sm font-semibold text-foreground",children:"Distance (km)"}),e.jsx("input",{id:"eventDistance",type:"number",step:"0.1",className:d,placeholder:"10",...n("distance_km")})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventLocation",className:"mb-1 block text-sm font-semibold text-foreground",children:"Location"}),e.jsx("input",{id:"eventLocation",type:"text",className:d,placeholder:"Vienna, Austria",...n("location")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventOffice",className:"mb-1 block text-sm font-semibold text-foreground",children:"Nearest Office"}),e.jsxs("select",{id:"eventOffice",className:d,...n("office_id"),children:[e.jsx("option",{value:"",children:"All offices"}),o?.map(i=>e.jsx("option",{value:i.id,children:i.name},i.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"eventUrl",className:"mb-1 block text-sm font-semibold text-foreground",children:"Website URL"}),e.jsx("input",{id:"eventUrl",type:"url",className:d,placeholder:"https://example.com",...n("website_url")})]}),e.jsx("button",{type:"submit",disabled:x,className:"flex h-11 items-center justify-center gap-2 rounded-xl bg-brand-dark-petrol font-bold text-white shadow-lg transition-all hover:shadow-xl disabled:opacity-50",children:x?e.jsx(_,{className:"h-4 w-4 animate-spin"}):"Add Race"})]})}function le({race:t,onAdd:s}){return e.jsxs("div",{className:"rounded-2xl bg-white p-4 shadow-sm transition-shadow hover:shadow-md",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-sm font-bold text-brand-dark-petrol",children:t.name}),e.jsxs("div",{className:"mt-1.5 flex flex-col gap-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(S,{className:"h-3 w-3 text-brand-teal"}),t.date]}),t.location&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground",children:[e.jsx(q,{className:"h-3 w-3 text-brand-teal"}),t.postalCode?`${t.postalCode} ${t.location}`:t.location]})]})]}),e.jsxs("div",{className:"flex shrink-0 gap-1.5",children:[s&&e.jsx("button",{onClick:()=>s(t),className:"flex h-8 w-8 items-center justify-center rounded-full bg-brand-dark-petrol/10 text-brand-dark-petrol transition-colors hover:bg-brand-dark-petrol hover:text-white",title:"Add to team races",children:e.jsx(F,{className:"h-3.5 w-3.5"})}),e.jsx("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",className:"flex h-8 w-8 items-center justify-center rounded-full bg-gray-100 text-muted-foreground transition-colors hover:bg-gray-200",title:"View on Runners World",children:e.jsx(z,{className:"h-3.5 w-3.5"})})]})]}),t.distances&&e.jsx("div",{className:"mt-3 flex flex-wrap gap-1.5",children:t.distances.split(",").map((o,r)=>e.jsx("span",{className:"rounded-full bg-brand-dark-petrol/8 px-2 py-0.5 text-xs font-bold text-brand-dark-petrol",children:o.trim()},r))})]})}const $="https://www.runnersworld.de",oe=`${$}/laufkalender/?speakingUrl=laufevents&q=`,ie="https://api.allorigins.win/raw?url=";async function de(t=1){const s=t===1?oe:`${$}/laufkalender/seite/${t}/?q=`,o=`${ie}${encodeURIComponent(s)}`,r=await fetch(o);if(!r.ok)throw new Error(`Proxy returned ${r.status}`);const n=await r.text();return ce(n)}function ce(t){const r=new DOMParser().parseFromString(t,"text/html").querySelectorAll('a[href*="/laufkalender/"][class*="rwEventsCalendar"]'),n=[];return r.forEach(l=>{try{const x=l.querySelector("div")?.querySelectorAll("span"),f=x?.[0]?.textContent?.trim()??"",d=x?.[1]?.textContent?.trim()??"",i=`${f} ${d}`.replace(/\.$/,"").trim(),m=l.querySelector(".va-headline span")?.textContent?.trim()??"",N=l.querySelector(".va-subline")?.textContent?.trim()??"",w=N.match(/^(\d+)\s*(.*)$/),y=w?.[1]??"",a=w?.[2]??N,k=l.querySelector(".flex.items-start")?.querySelector("p")?.textContent?.trim()??"",C=l.getAttribute("href")??"",O=C.startsWith("http")?C:`${$}${C}`;m&&n.push({name:m,date:i,location:a,postalCode:y,distances:k,url:O})}catch{}}),n}function me(t=1){return I({queryKey:["external-races",t],queryFn:()=>de(t),staleTime:1e3*60*30,retry:1})}function _e(){const[t,s]=b.useState(!1),[o,r]=b.useState("discover"),[n,l]=b.useState(1),{data:c}=P(),{data:x}=U(),f=D(),{data:d,isLoading:i,error:u}=me(n),[m,j]=b.useState(null),[N,w]=b.useState(!1);c&&!N&&(j(c.office_id??null),w(!0));const y=async a=>{const h=a.distances.split(",")[0]?.trim(),p=parseFloat(h?.replace(",",".")??""),k=xe(a.date);await f.mutateAsync({name:a.name,date:k,location:a.location?`${a.postalCode} ${a.location}`.trim():null,distance_km:isNaN(p)?null:p,website_url:a.url,office_id:m}),r("team")};return e.jsxs(M,{children:[e.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-extrabold text-brand-dark-petrol",children:"Race Finder"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Discover & share upcoming races"})]}),o==="team"&&e.jsxs("button",{onClick:()=>s(!t),className:g("flex items-center gap-1.5 rounded-xl px-4 py-2 text-sm font-bold transition-all",t?"bg-gray-100 text-muted-foreground":"bg-brand-dark-petrol text-white shadow-lg hover:shadow-xl"),children:[t?e.jsx(te,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"}),t?"Cancel":"Add"]})]}),e.jsxs("div",{className:"mb-5 flex gap-2",children:[e.jsxs("button",{onClick:()=>r("discover"),className:g("flex items-center gap-1.5 rounded-xl px-4 py-2 text-sm font-bold transition-all",o==="discover"?"bg-brand-dark-petrol text-white shadow-sm":"bg-gray-100 text-muted-foreground hover:bg-gray-200"),children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),"Discover"]}),e.jsxs("button",{onClick:()=>r("team"),className:g("flex items-center gap-1.5 rounded-xl px-4 py-2 text-sm font-bold transition-all",o==="team"?"bg-brand-dark-petrol text-white shadow-sm":"bg-gray-100 text-muted-foreground hover:bg-gray-200"),children:[e.jsx(R,{className:"h-3.5 w-3.5"}),"Team Races"]})]}),o==="team"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"no-scrollbar mb-5 flex gap-2 overflow-x-auto pb-1",children:[e.jsx("button",{onClick:()=>j(null),className:g("shrink-0 rounded-full px-3.5 py-1.5 text-xs font-bold transition-all",m===null?"bg-brand-dark-petrol text-white shadow-sm":"bg-gray-100 text-muted-foreground hover:bg-gray-200"),children:"All"}),x?.map(a=>{const h=G.find(p=>p.name===a.name);return e.jsx("button",{onClick:()=>j(m===a.id?null:a.id),className:g("shrink-0 rounded-full px-3.5 py-1.5 text-xs font-bold transition-all",m===a.id?"text-white shadow-sm":"bg-gray-100 text-muted-foreground hover:bg-gray-200"),style:m===a.id?{backgroundColor:h?.colorTheme??"#00677F"}:void 0,children:a.name},a.id)})]}),t&&e.jsx("div",{className:"mb-6 rounded-2xl bg-white p-4 shadow-sm",children:e.jsx(ne,{onSuccess:()=>s(!1)})}),e.jsx(re,{officeId:m})]}),o==="discover"&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"mb-4 rounded-2xl bg-brand-dark-petrol/5 px-4 py-3",children:e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Upcoming races from ",e.jsx("span",{className:"font-bold text-brand-dark-petrol",children:"Runners World Laufkalender"}),". Tap ",e.jsx("span",{className:"font-bold text-brand-dark-petrol",children:"+"})," to add a race to your team."]})}),i&&e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(_,{className:"h-5 w-5 animate-spin text-brand-teal"})}),u&&e.jsxs("div",{className:"flex flex-col items-center gap-3 py-8 text-center",children:[e.jsx(K,{className:"h-8 w-8 text-muted-foreground/30"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-foreground",children:"Could not load races"}),e.jsx("p",{className:"mt-1 text-xs text-muted-foreground",children:"The external race calendar is temporarily unavailable."})]}),e.jsx("a",{href:"https://www.runnersworld.de/laufkalender/?speakingUrl=laufevents&q=",target:"_blank",rel:"noopener noreferrer",className:"mt-2 rounded-xl bg-brand-dark-petrol px-4 py-2 text-sm font-bold text-white shadow-sm",children:"Open on Runners World"})]}),d&&d.length>0&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex flex-col gap-2.5",children:d.map((a,h)=>e.jsx(le,{race:a,onAdd:y},`${a.url}-${h}`))}),e.jsxs("div",{className:"mt-6 flex items-center justify-center gap-3",children:[e.jsx("button",{onClick:()=>l(a=>Math.max(1,a-1)),disabled:n===1,className:"flex h-9 w-9 items-center justify-center rounded-xl bg-white text-brand-dark-petrol shadow-sm transition-colors hover:bg-gray-50 disabled:opacity-30",children:e.jsx(Y,{className:"h-4 w-4"})}),e.jsxs("span",{className:"text-sm font-bold text-brand-dark-petrol",children:["Page ",n]}),e.jsx("button",{onClick:()=>l(a=>a+1),className:"flex h-9 w-9 items-center justify-center rounded-xl bg-white text-brand-dark-petrol shadow-sm transition-colors hover:bg-gray-50",children:e.jsx(Q,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"mt-3 text-center text-xs text-muted-foreground",children:"Source: runnersworld.de/laufkalender"})]}),d&&d.length===0&&!i&&e.jsx("div",{className:"py-8 text-center text-sm text-muted-foreground",children:"No more races found on this page."})]})]})}function xe(t){const s={jan:"01",feb:"02",m√§r:"03",mar:"03",apr:"04",mai:"05",may:"05",jun:"06",jul:"07",aug:"08",sep:"09",okt:"10",oct:"10",nov:"11",dez:"12",dec:"12"},r=t.replace(".","").trim().split(/\s+/);if(r.length<3)return new Date().toISOString().split("T")[0];const n=r[0].padStart(2,"0"),l=r[1].toLowerCase().slice(0,3),c=s[l]??"01";return`${r[2]}-${c}-${n}`}export{_e as default};
