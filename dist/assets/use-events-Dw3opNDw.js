import{c as i,i as u,u as y,s}from"./index-BRLjwUl5.js";import{u as d}from"./page-container-CooLEeSj.js";import{u as l}from"./useMutation-BnaJWjYm.js";const f=[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]],w=i("external-link",f);const m=[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]],g=i("share-2",m);const h=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],k=i("users",h);function x(t){return d({queryKey:["events","upcoming",t??"all"],queryFn:async()=>{const r=new Date().toISOString().split("T")[0];let e=s.from("events").select("*, participations(user_id, status, profiles(name, avatar_url)), offices(id, name, color_theme)").gte("date",r).order("date",{ascending:!0});t&&(e=e.eq("office_id",t));const{data:n,error:a}=await e;if(a)throw a;return n}})}function E(t){return d({queryKey:["events",t],queryFn:async()=>{const{data:r,error:e}=await s.from("events").select("*, participations(user_id, status, profiles(name, avatar_url)), offices(id, name, color_theme)").eq("id",t).single();if(e)throw e;return r},enabled:!!t})}function M(){const t=u(),{user:r}=y();return l({mutationFn:async e=>{if(!r)throw new Error("Not authenticated");const{data:n,error:a}=await s.from("events").insert({...e,created_by:r.id}).select().single();if(a)throw a;return n},onSuccess:()=>{t.invalidateQueries({queryKey:["events"]})}})}function S(){const t=u(),{user:r}=y();return l({mutationFn:async({eventId:e,status:n})=>{if(!r)throw new Error("Not authenticated");const{data:a}=await s.from("participations").select("status").eq("event_id",e).eq("user_id",r.id).maybeSingle();if(a?.status===n){const{error:c}=await s.from("participations").delete().eq("event_id",e).eq("user_id",r.id);if(c)throw c;return null}const{data:p,error:o}=await s.from("participations").upsert({event_id:e,user_id:r.id,status:n}).select().single();if(o)throw o;return p},onSuccess:()=>{t.invalidateQueries({queryKey:["events"]})}})}export{w as E,g as S,k as U,M as a,E as b,S as c,x as u};
