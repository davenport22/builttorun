const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-CBy5Ga37.js","assets/index-BRLjwUl5.js","assets/index-DVc_O0g-.css"])))=>i.map(i=>d[i]);
import{c as A,r as a,_ as H,h as V,j as e,L as I}from"./index-BRLjwUl5.js";import{P as q}from"./page-container-CooLEeSj.js";import{c as z}from"./use-races-Bfw9PVRB.js";import{p as G}from"./formatting-6Y3PSrOr.js";import{U as B}from"./images-if8H7XIe.js";import{M as U}from"./mountain-Bhx1rOsA.js";import{A as J}from"./arrow-right-CKog1t_u.js";import{C as K}from"./circle-alert-xLKzMs_p.js";import{C as Q}from"./check-Bb7JHISM.js";import"./useMutation-BnaJWjYm.js";const X=[["path",{d:"M12 3q1 4 4 6.5t3 5.5a1 1 0 0 1-14 0 5 5 0 0 1 1-3 1 1 0 0 0 5 0c0-2-1.5-3-1.5-5q0-2 2.5-4",key:"1slcih"}]],Z=A("flame",X);const ee=[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]],te=A("upload",ee);function se(n){const r=[/marathon/i,/half\s*marathon/i,/(\d+[.,]\d+)\s*km/i,/(\d+)\s*km/i,/(\d+[.,]\d+)\s*k\b/i,/(\d+)\s*k\b/i],o=n.toLowerCase();if(/\bmarathon\b/i.test(n)&&!/half/i.test(n))return 42.195;if(/half\s*marathon/i.test(n))return 21.1;for(const l of r.slice(2)){const u=n.match(l);if(u?.[1]){const d=parseFloat(u[1].replace(",","."));if(d>0&&d<=200)return d}}const t=o.match(/\b(\d+)k\b/);if(t){const l=parseInt(t[1]);if(l>0&&l<=200)return l}return null}function ae(n){const r=[/(\d{1,2}):(\d{2}):(\d{2})/,/(\d{1,2}):(\d{2})\b/];for(const o of r){const t=n.match(o);if(t){if(t[3]!==void 0)return`${t[1].padStart(2,"0")}:${t[2]}:${t[3]}`;if(parseInt(t[1])<60)return`00:${t[1].padStart(2,"0")}:${t[2]}`}}return null}function re(n){const r=n.split(`
`).filter(o=>o.trim().length>3);if(r.length>0){for(const o of r){const t=o.trim();if(!/^\d+[:/.-]/.test(t)&&t.length<=80)return t}return r[0].trim().slice(0,80)}return null}function ne(){const[n,r]=a.useState("idle"),[o,t]=a.useState(null),[l,u]=a.useState(null),d=a.useCallback(async v=>{r("processing"),u(null);try{const{createWorker:m}=await H(async()=>{const{createWorker:p}=await import("./index-CBy5Ga37.js").then(b=>b.i);return{createWorker:p}},__vite__mapDeps([0,1,2])),h=await m("eng+deu"),{data:i}=await h.recognize(v);await h.terminate();const x={rawText:i.text,parsedDistance:se(i.text),parsedTime:ae(i.text),parsedRaceName:re(i.text),confidence:i.confidence};t(x),r("done")}catch(m){u(m instanceof Error?m.message:"OCR processing failed"),r("error")}},[]),k=a.useCallback(()=>{r("idle"),t(null),u(null)},[]);return{status:n,result:o,error:l,processImage:d,reset:k}}const oe=1.1;function le(n,r){return r?Number((n*oe).toFixed(2)):n}const F=[{headline:"Absolute Machine!",sub:"That pace is not human."},{headline:"Fucking Legend!",sub:"The streets were not ready for you."},{headline:"Beast Mode!",sub:"You just ate that distance alive."},{headline:"Unstoppable!",sub:"Wind couldn't even keep up with you."},{headline:"Who Are You?!",sub:"Even Kipchoge would be impressed."},{headline:"Pure Domination!",sub:"The road owes you an apology."},{headline:"Proper Machine!",sub:"Your legs are weapons of mass distance."},{headline:"Stone Cold Runner!",sub:"Other runners are filing complaints."},{headline:"Built Different!",sub:"This is what peak performance looks like."},{headline:"Menace to Society!",sub:"The leaderboard is shaking right now."},{headline:"No Mercy!",sub:"That was violent and we loved every km."},{headline:"Relentless!",sub:"Pain tried to stop you. Pain lost."}];function ie(){return F[Math.floor(Math.random()*F.length)]}function ce(){const n=V(),r=a.useRef(null),{status:o,result:t,processImage:l,reset:u}=ne(),d=z(),[k,v]=a.useState(null),[m,h]=a.useState(null),[i,x]=a.useState("upload"),[p,b]=a.useState(""),[w,y]=a.useState(""),[S,R]=a.useState(""),[T,D]=a.useState(new Date().toISOString().split("T")[0]),[f,M]=a.useState(!1),[E,g]=a.useState(null),[P]=a.useState(()=>ie()),C=a.useCallback(async s=>{v(s),h(URL.createObjectURL(s)),x("processing"),await l(s),x("confirm")},[l]),W=s=>{const c=s.target.files;c?.[0]&&C(c[0])},$=a.useCallback(s=>{s.preventDefault();const c=s.dataTransfer.files;c?.[0]&&c[0].type.startsWith("image/")&&C(c[0])},[C]);o==="done"&&t&&i==="confirm"&&(!p&&t.parsedRaceName&&b(t.parsedRaceName),!w&&t.parsedDistance&&y(String(t.parsedDistance)),!S&&t.parsedTime&&R(t.parsedTime));const j=parseFloat(w)||0,_=le(j,f),Y=async s=>{s.preventDefault(),g(null);const c=G(S);if(!c||c<=0){g("Please enter a valid time (e.g., 1:23:45 or 45:30)");return}if(j<=0){g("Please enter a valid distance");return}try{await d.mutateAsync({race:{race_name:p||"Unnamed Race",distance_km:j,time_seconds:c,date:T,elevation_boost:f},screenshot:k??void 0}),x("success")}catch(L){g(L instanceof Error?L.message:"Failed to save race")}},O=()=>{v(null),h(null),x("upload"),b(""),y(""),R(""),D(new Date().toISOString().split("T")[0]),M(!1),g(null),u()},N="w-full rounded-xl border border-input bg-muted/50 px-4 py-2.5 text-sm outline-none ring-ring transition-colors focus:bg-white focus:ring-2";return i==="success"?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsxs("div",{className:"relative -mx-4 -mt-4 mb-6 w-[calc(100%+2rem)] overflow-hidden rounded-t-3xl",children:[e.jsx("img",{src:B,alt:"",className:"h-48 w-full object-cover grayscale"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-white via-white/40 to-transparent"}),e.jsx("div",{className:"absolute inset-x-0 bottom-4 flex justify-center",children:e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-full bg-brand-mint shadow-lg",children:e.jsx(Z,{className:"h-8 w-8 text-brand-dark-petrol"})})})]}),e.jsx("h2",{className:"text-center text-2xl font-black tracking-tight text-brand-dark-petrol",children:P.headline}),e.jsx("p",{className:"mt-2 text-center text-sm text-muted-foreground",children:P.sub}),e.jsxs("div",{className:"mt-6 w-full rounded-2xl bg-brand-dark-petrol/5 p-4 text-center",children:[e.jsx("p",{className:"text-xs font-medium uppercase tracking-wider text-muted-foreground",children:"You just logged"}),e.jsxs("p",{className:"mt-1 text-3xl font-extrabold tracking-tight text-brand-dark-petrol",children:[_," ",e.jsx("span",{className:"text-lg font-bold",children:"km"})]}),f&&e.jsxs("div",{className:"mt-1 flex items-center justify-center gap-1 text-xs text-brand-teal",children:[e.jsx(U,{className:"h-3 w-3"}),e.jsx("span",{children:"incl. elevation boost"})]})]}),e.jsxs("div",{className:"mt-6 flex w-full flex-col gap-2.5",children:[e.jsxs("button",{onClick:()=>n("/my-races"),className:"flex h-11 items-center justify-center gap-2 rounded-xl bg-brand-dark-petrol font-bold text-white shadow-lg transition-all hover:shadow-xl",children:["View My Races",e.jsx(J,{className:"h-4 w-4"})]}),e.jsx("button",{onClick:O,className:"flex h-11 items-center justify-center rounded-xl border border-brand-dark-petrol/20 font-semibold text-brand-dark-petrol transition-colors hover:bg-brand-dark-petrol/5",children:"Log Another Race"})]})]}):i==="upload"?e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{onDrop:$,onDragOver:s=>s.preventDefault(),onClick:()=>r.current?.click(),className:"flex cursor-pointer flex-col items-center gap-3 rounded-2xl border-2 border-dashed border-brand-dark-petrol/20 bg-brand-dark-petrol/5 p-10 transition-colors hover:border-brand-dark-petrol/40 hover:bg-brand-dark-petrol/10",children:[e.jsx("div",{className:"flex h-14 w-14 items-center justify-center rounded-2xl bg-brand-dark-petrol/10",children:e.jsx(te,{className:"h-7 w-7 text-brand-dark-petrol/60"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold text-brand-dark-petrol",children:"Upload Screenshot"}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Drag & drop or tap to select from camera/gallery"})]})]}),e.jsx("input",{ref:r,type:"file",accept:"image/*",capture:"environment",onChange:W,className:"hidden"}),e.jsxs("div",{className:"relative flex items-center",children:[e.jsx("div",{className:"flex-1 border-t border-border"}),e.jsx("span",{className:"px-3 text-sm text-muted-foreground",children:"or enter manually"}),e.jsx("div",{className:"flex-1 border-t border-border"})]}),e.jsx("button",{onClick:()=>x("confirm"),className:"rounded-xl border-2 border-brand-dark-petrol/20 py-3 text-sm font-bold text-brand-dark-petrol transition-colors hover:bg-brand-dark-petrol/5",children:"Enter Manually"})]}):i==="processing"?e.jsxs("div",{className:"flex flex-col items-center gap-4 py-12",children:[e.jsx("div",{className:"flex h-16 w-16 items-center justify-center rounded-2xl bg-brand-dark-petrol/10",children:e.jsx(I,{className:"h-8 w-8 animate-spin text-brand-dark-petrol"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold text-brand-dark-petrol",children:"Processing Screenshot..."}),e.jsx("p",{className:"mt-1 text-sm text-muted-foreground",children:"Extracting race data with OCR"})]}),m&&e.jsx("img",{src:m,alt:"Race screenshot",className:"mt-4 max-h-48 rounded-2xl border border-border object-contain shadow-sm"})]}):e.jsxs("form",{onSubmit:Y,className:"flex flex-col gap-4",children:[m&&e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:m,alt:"Race screenshot",className:"max-h-36 rounded-2xl border border-border object-contain shadow-sm"})}),t&&t.confidence<50&&e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-amber-50 px-4 py-3 text-sm text-amber-700",children:[e.jsx(K,{className:"h-4 w-4 shrink-0"}),"Low OCR confidence. Please verify the extracted data."]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"raceName",className:"mb-1 block text-sm font-semibold text-foreground",children:"Race Name"}),e.jsx("input",{id:"raceName",type:"text",value:p,onChange:s=>b(s.target.value),placeholder:"e.g., Vienna City Marathon",className:N})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"distance",className:"mb-1 block text-sm font-semibold text-foreground",children:"Distance (km)"}),e.jsx("input",{id:"distance",type:"number",step:"0.01",min:"0",value:w,onChange:s=>y(s.target.value),placeholder:"10",className:N})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"time",className:"mb-1 block text-sm font-semibold text-foreground",children:"Time (HH:MM:SS)"}),e.jsx("input",{id:"time",type:"text",value:S,onChange:s=>R(s.target.value),placeholder:"1:23:45",className:N})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"date",className:"mb-1 block text-sm font-semibold text-foreground",children:"Date"}),e.jsx("input",{id:"date",type:"date",value:T,max:new Date().toISOString().split("T")[0],onChange:s=>D(s.target.value),className:N})]}),e.jsx("div",{className:"rounded-2xl border border-brand-mint/30 bg-brand-mint/5 p-4",children:e.jsxs("label",{className:"flex cursor-pointer items-start gap-3",children:[e.jsx("input",{type:"checkbox",checked:f,onChange:s=>M(s.target.checked),className:"mt-0.5 h-4 w-4 rounded border-border accent-brand-teal"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(U,{className:"h-4 w-4 text-brand-teal"}),e.jsx("span",{className:"text-sm font-bold text-foreground",children:"Elevation Boost (+10%)"})]}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Was this a hilly/mountain race? Your scored distance gets a 10% bonus."}),f&&j>0&&e.jsxs("p",{className:"mt-1.5 text-sm font-bold text-brand-teal",children:[j," km â†’ ",_," km scored"]})]})]})}),E&&e.jsx("div",{className:"rounded-xl bg-destructive/10 px-4 py-3 text-sm text-destructive",children:E}),e.jsxs("div",{className:"flex gap-2.5",children:[e.jsx("button",{type:"button",onClick:O,className:"flex-1 rounded-xl border-2 border-border py-2.5 text-sm font-bold text-muted-foreground transition-colors hover:bg-muted",children:"Reset"}),e.jsxs("button",{type:"submit",disabled:d.isPending,className:"flex flex-[2] items-center justify-center gap-2 rounded-xl bg-brand-dark-petrol py-2.5 text-sm font-bold text-white shadow-lg transition-all hover:shadow-xl disabled:opacity-50",children:[d.isPending?e.jsx(I,{className:"h-4 w-4 animate-spin"}):e.jsx(Q,{className:"h-4 w-4"}),"Save Race"]})]})]})}function ve(){return e.jsxs(q,{children:[e.jsxs("div",{className:"relative -mx-4 -mt-4 mb-6 overflow-hidden rounded-b-3xl",children:[e.jsx("img",{src:B,alt:"",className:"h-36 w-full object-cover grayscale"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-brand-dark-petrol via-brand-dark-petrol/70 to-transparent"}),e.jsxs("div",{className:"absolute inset-x-0 bottom-0 p-5",children:[e.jsx("h1",{className:"text-xl font-extrabold text-white",children:"Log a Race"}),e.jsx("p",{className:"mt-0.5 text-xs font-medium text-brand-mint",children:"Upload your screenshot or enter manually"})]})]}),e.jsx("div",{className:"rounded-3xl bg-white p-4 shadow-sm",children:e.jsx(ce,{})})]})}export{ve as default};
