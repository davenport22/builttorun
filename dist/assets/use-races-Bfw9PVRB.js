import{u as f}from"./page-container-CooLEeSj.js";import{u as y,i as h,s as o}from"./index-BRLjwUl5.js";import{u as _}from"./useMutation-BnaJWjYm.js";function v(){const{user:e}=y();return f({queryKey:["races","mine",e?.id],queryFn:async()=>{if(!e)return[];const{data:t,error:r}=await o.from("races").select("*").eq("user_id",e.id).order("date",{ascending:!1});if(r)throw r;return t},enabled:!!e})}function F(e=20){return f({queryKey:["races","recent",e],queryFn:async()=>{const{data:t,error:r}=await o.from("races").select("*, profiles(name, avatar_url, offices(name, color_theme))").order("created_at",{ascending:!1}).limit(e);if(r)throw r;return t}})}function D(){const{user:e}=y();return f({queryKey:["races","stats",e?.id],queryFn:async()=>{if(!e)return null;const{data:t,error:r}=await o.from("races").select("distance_km, scored_distance_km, time_seconds, elevation_boost, date").eq("user_id",e.id);if(r)throw r;const s=t,i=new Date,l=s.filter(a=>{const n=new Date(a.date);return n.getMonth()===i.getMonth()&&n.getFullYear()===i.getFullYear()}),u=s.reduce((a,n)=>a+Number(n.scored_distance_km),0),m=s.reduce((a,n)=>a+n.time_seconds,0),c=s.reduce((a,n)=>a+Number(n.distance_km),0),d=l.reduce((a,n)=>a+Number(n.scored_distance_km),0),w=s.filter(a=>a.elevation_boost).length,p=u-c;return{totalScoredDistance:Number(u.toFixed(2)),totalRaces:s.length,monthDistance:Number(d.toFixed(2)),averagePace:c>0?m/c:0,boostRaces:w,elevationBonus:Number(p.toFixed(2))}},enabled:!!e})}function R(){const e=h(),{user:t}=y();return _({mutationFn:async({race:r,screenshot:s})=>{if(!t)throw new Error("Not authenticated");let i;if(s){const m=s.name.split(".").pop()||"jpg",c=`${t.id}/${crypto.randomUUID()}.${m}`,{error:d}=await o.storage.from("race-screenshots").upload(c,s,{contentType:s.type});if(d)throw d;i=c}const{data:l,error:u}=await o.from("races").insert({...r,user_id:t.id,screenshot_url:i??null}).select().single();if(u)throw u;return l},onSuccess:()=>{e.invalidateQueries({queryKey:["races"]}),e.invalidateQueries({queryKey:["leaderboard"]})}})}function K(){const e=h();return _({mutationFn:async t=>{t.screenshot_url&&await o.storage.from("race-screenshots").remove([t.screenshot_url]);const{error:r}=await o.from("races").delete().eq("id",t.id);if(r)throw r},onSuccess:()=>{e.invalidateQueries({queryKey:["races"]}),e.invalidateQueries({queryKey:["leaderboard"]})}})}export{v as a,F as b,R as c,K as d,D as u};
